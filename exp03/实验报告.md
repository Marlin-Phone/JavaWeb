# 实验三  Web组件重用与JavaBeans

## 一、实验目的
1. 理解静态包含和动态包含的概念，掌握相关指令和动作的使用；
2. 掌握JavaBeans的含义和创建方法；
3. 重点掌握在JSP页面中使用JavaBeans的标准动作。

## 二、实验要求
1. 实验前进行预习，完成实验预习报告；
2. 按照每一项实验内容进行上机实践与编程，将程序源代码和运行结果图附在实验报告中实验内容对应的部分。
3. 实验预习报告和实验报告打印装订在一起。
4. 将每一次实验的源代码按目录组织保存并压缩，按照老师指定的要求进行提交。代码保存方式如：exp03表示实验三Web项目的名称，其下保存各项实验内容的源文件及相关资源，将整个exp03文件夹进行压缩后命名为班级-姓名-实验03，如：计171-张三-实验03。

## 三、实验内容及要求

### 1. include静态指令的使用

#### 实验步骤：
1. 创建名称为exp03的Web项目
2. 编写hello.jsp页面，其中声明一个变量userName，用于获取请求地址后查询串参数userName的值
3. 使用<%@ include>静态指令包含response.jsp页面，通过response.jsp页面显示userName的值

#### 方法一：response.jsp页面中通过JSP表达式直接输出变量userName的值

**hello.jsp源代码：**
```jsp
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<%
    String userName = request.getParameter("userName");
%>
<html>
<head>
    <title>静态包含示例 - 方法一</title>
</head>
<body>
<h2>主页面</h2>
<p>主页面中的userName变量值：<%= userName %></p>
<h3>包含的子页面内容：</h3>
<%@ include file="response.jsp" %>
</body>
</html>
```

**response.jsp源代码：**
```jsp
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<p>子页面中的userName变量值：<%= userName %></p>
<p>这是通过静态包含引入的子页面内容</p>
```

#### 方法二：通过pageContext作用域属性，在主页面和子页面间共享userName的值，降低主页面和子页面的依赖性

**hello2.jsp源代码：**
```jsp
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<%
    String userName = request.getParameter("userName");
    pageContext.setAttribute("userName", userName);
%>
<html>
<head>
    <title>静态包含示例 - 方法二</title>
</head>
<body>
<h2>主页面</h2>
<p>主页面中的userName变量值：<%= userName %></p>
<h3>包含的子页面内容：</h3>
<%@ include file="response2.jsp" %>
</body>
</html>
```

**response2.jsp源代码：**
```jsp
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<p>子页面通过pageContext获取的userName值：<%= pageContext.getAttribute("userName") %></p>
<p>这是通过静态包含引入的子页面内容（方法二）</p>
```

### 2. <jsp:include>动作指令的使用

#### 实验步骤：
1. 编写main.jsp页面，其中声明一个变量userName，用于获取请求地址后查询串参数userName的值
2. 在main.jsp页面中使用<jsp:include>动作包含subpage.jsp页面，通过subpage.jsp页面显示userName的值

**main.jsp源代码：**
```jsp
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<%
    String userName = request.getParameter("userName");
    request.setAttribute("userName", userName);
%>
<html>
<head>
    <title>动态包含示例</title>
</head>
<body>
<h2>主页面</h2>
<p>主页面中的userName变量值：<%= userName %></p>
<h3>包含的子页面内容：</h3>
<jsp:include page="subpage.jsp">
    <jsp:param name="userName" value="<%= userName %>"/>
</jsp:include>
</body>
</html>
```

**subpage.jsp源代码：**
```jsp
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<p>子页面中通过param获取的userName值：<%= request.getParameter("userName") %></p>
<p>子页面中通过request.getAttribute获取的userName值：<%= request.getAttribute("userName") %></p>
<p>这是通过动态包含引入的子页面内容</p>
```

### 3. <jsp:useBean>、<jsp:setProperty>、<jsp:getProperty>动作的使用

#### 实验步骤：
1. 创建UserBean.java，包含username, password, email三个私有数据成员和相应的访问器和设置器
2. 编写登录页面login.html
3. 编写display.jsp页面，使用JavaBeans显示输入的信息

**UserBean.java源代码：**
```java
package com.beans;

import java.io.Serializable;

public class UserBean implements Serializable {
    private String username;
    private String password;
    private String email;
    
    // 无参构造函数
    public UserBean() {
    }
    
    // getter和setter方法
    public String getUsername() {
        return username;
    }
    
    public void setUsername(String username) {
        this.username = username;
    }
    
    public String getPassword() {
        return password;
    }
    
    public void setPassword(String password) {
        this.password = password;
    }
    
    public String getEmail() {
        return email;
    }
    
    public void setEmail(String email) {
        this.email = email;
    }
}
```

**login.html源代码：**
```html
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>用户登录</title>
</head>
<body>
<h2>请登录</h2>
<form action="display.jsp" method="post">
    <table>
        <tr>
            <td>用户名:</td>
            <td><input type="text" name="username" required></td>
        </tr>
        <tr>
            <td>密码:</td>
            <td><input type="password" name="password" required></td>
        </tr>
        <tr>
            <td>邮箱:</td>
            <td><input type="email" name="email" required></td>
        </tr>
        <tr>
            <td colspan="2">
                <input type="submit" value="提交">
                <input type="reset" value="重置">
            </td>
        </tr>
    </table>
</form>
</body>
</html>
```

**display.jsp源代码：**
```jsp
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<jsp:useBean id="user" class="com.beans.UserBean" scope="page"/>
<jsp:setProperty name="user" property="*"/>

<html>
<head>
    <title>用户信息显示</title>
</head>
<body>
<h2>用户信息</h2>
<table border="1">
    <tr>
        <td>用户名:</td>
        <td><jsp:getProperty name="user" property="username"/></td>
    </tr>
    <tr>
        <td>密码:</td>
        <td><jsp:getProperty name="user" property="password"/></td>
    </tr>
    <tr>
        <td>邮箱:</td>
        <td><jsp:getProperty name="user" property="email"/></td>
    </tr>
</table>
</body>
</html>
```

### 4. 使用JavaBean构造一个简单的计算器，能够进行"+、-、*、/"运算

#### 实验步骤：
1. 编写实现简单计算器的JavaBean：SimpleCalculator.java
2. 编写calculate.jsp页面，用户通过表单输入两个操作数和运算符，调用该页面自身处理该表单

**SimpleCalculator.java源代码：**
```java
package com.beans;

import java.io.Serializable;

public class SimpleCalculator implements Serializable {
    private double first;
    private double second;
    private String operator;
    private double result;
    
    // 无参构造函数
    public SimpleCalculator() {
    }
    
    // 计算方法
    public void calculate() {
        switch (operator) {
            case "+":
                result = first + second;
                break;
            case "-":
                result = first - second;
                break;
            case "*":
                result = first * second;
                break;
            case "/":
                if (second != 0) {
                    result = first / second;
                } else {
                    result = Double.NaN; // 表示除零错误
                }
                break;
            default:
                result = 0;
        }
    }
    
    // getter和setter方法
    public double getFirst() {
        return first;
    }
    
    public void setFirst(double first) {
        this.first = first;
    }
    
    public double getSecond() {
        return second;
    }
    
    public void setSecond(double second) {
        this.second = second;
    }
    
    public String getOperator() {
        return operator;
    }
    
    public void setOperator(String operator) {
        this.operator = operator;
    }
    
    public double getResult() {
        return result;
    }
    
    public void setResult(double result) {
        this.result = result;
    }
}
```

**calculate.jsp源代码：**
```jsp
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<jsp:useBean id="calculator" class="com.beans.SimpleCalculator" scope="page"/>
<jsp:setProperty name="calculator" property="*"/>

<%
    // 如果是表单提交，则进行计算
    String first = request.getParameter("first");
    if (first != null && !first.isEmpty()) {
        calculator.calculate();
    }
%>

<html>
<head>
    <title>简单计算器</title>
</head>
<body>
<h2>简单计算器</h2>

<form method="post">
    <table>
        <tr>
            <td>第一个数:</td>
            <td><input type="text" name="first" value="<%= request.getParameter("first") != null ? request.getParameter("first") : "" %>"></td>
        </tr>
        <tr>
            <td>运算符:</td>
            <td>
                <select name="operator">
                    <option value="+" <%= "+".equals(request.getParameter("operator")) ? "selected" : "" %> >+</option>
                    <option value="-" <%= "-".equals(request.getParameter("operator")) ? "selected" : "" %> >-</option>
                    <option value="*" <%= "*".equals(request.getParameter("operator")) ? "selected" : "" %> >*</option>
                    <option value="/" <%= "/".equals(request.getParameter("operator")) ? "selected" : "" %> >/</option>
                </select>
            </td>
        </tr>
        <tr>
            <td>第二个数:</td>
            <td><input type="text" name="second" value="<%= request.getParameter("second") != null ? request.getParameter("second") : "" %>"></td>
        </tr>
        <tr>
            <td colspan="2">
                <input type="submit" value="计算">
                <input type="reset" value="重置">
            </td>
        </tr>
    </table>
</form>

<%
    // 显示计算结果
    if (first != null && !first.isEmpty()) {
        if (Double.isNaN(calculator.getResult())) {
%>
<p style="color:red;">错误：除数不能为零！</p>
<%
        } else {
%>
<h3>计算结果：<%= calculator.getFirst() %> <%= calculator.getOperator() %> <%= calculator.getSecond() %> = <%= calculator.getResult() %></h3>
<%
        }
    }
%>
</body>
</html>
```

## 四、思考题

### 1. 什么是Model 1体系结构，有何缺点？

**答：** Model 1体系结构是早期JSP开发中的一种设计模式，其中JSP页面既负责表现层又包含业务逻辑和控制流程。

**特点：**
- JSP页面直接接收用户请求
- JSP页面中嵌入Java代码处理业务逻辑
- JSP页面直接访问数据库或其他数据源
- 页面既负责视图展示又负责业务处理

**缺点：**
1. **职责不清晰**：JSP页面承担了过多职责，违反了单一职责原则
2. **难以维护**：业务逻辑和表现逻辑混合在一起，代码混乱，难以维护
3. **难以复用**：业务逻辑嵌入在JSP中，难以在其他地方复用
4. **开发效率低**：前端开发人员和后端开发人员难以分工协作
5. **测试困难**：业务逻辑和视图混合，难以进行单元测试

### 2. 什么是MVC设计模式？其优点是什么？

**答：** MVC（Model-View-Controller）是一种软件架构设计模式，将应用程序分为三个核心组件：

**三个组件：**
- **Model（模型）**：负责数据和业务逻辑，处理数据的存储、检索、验证等操作
- **View（视图）**：负责用户界面的展示，向用户显示数据
- **Controller（控制器）**：负责处理用户输入，协调Model和View之间的交互

**优点：**
1. **职责分离**：各组件职责明确，便于开发和维护
2. **易于维护**：修改某一层不会影响其他层
3. **可复用性强**：Model可以被多个View复用
4. **便于团队协作**：不同开发者可以专注于不同层的开发
5. **易于测试**：各层可以独立进行单元测试
6. **灵活性高**：可以轻松更换视图或修改业务逻辑

### 3. 实现MVC设计模式的一般步骤是什么？

**答：** 实现MVC设计模式的一般步骤如下：

1. **需求分析**：分析系统需求，确定功能模块

2. **设计Model层**：
   - 设计数据模型类
   - 创建数据访问对象（DAO）
   - 实现业务逻辑处理类

3. **设计View层**：
   - 设计用户界面原型
   - 创建视图页面（JSP、HTML等）
   - 确定数据展示方式

4. **设计Controller层**：
   - 创建控制器Servlet
   - 实现请求分发逻辑
   - 协调Model和View的交互

5. **建立组件间的关联**：
   - Controller接收用户请求
   - Controller调用Model处理业务逻辑
   - Model返回处理结果给Controller
   - Controller选择合适的View进行展示

6. **配置部署描述符**：
   - 配置web.xml文件
   - 设置Servlet映射关系
   - 配置初始化参数

7. **测试与优化**：
   - 进行单元测试
   - 进行集成测试
   - 根据测试结果优化代码结构