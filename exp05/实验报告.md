# 实验五  JDBC数据库访问与DAO设计模式

班级                       学号                        姓名                   
## 实验报告

### 一、实验目的

1. 掌握传统的JDBC数据库访问方法；
2. 掌握基于JNDI数据源的数据库访问方法。
3. 掌握DAO设计模式及其应用方法。

### 二、实验要求

1. 实验前进行预习，完成实验预习报告，将预习内容以简答题的形式进行回答；
2. 按照每一项实验内容进行上机实践与编程，将程序源代码和运行结果图附在实验报告中实验内容对应的部分。
3. 实验预习报告和实验报告打印装订在一起。
4. 将每一次实验的源代码按目录组织保存并压缩，按照老师指定的要求进行提交。代码保存方式如：exp05表示实验五Web项目的名称，其下保存各项实验内容的源文件及相关资源，将整个exp05文件夹进行压缩后命名为班级-姓名-实验05，如：计171-张三-实验05。

### 三、实验内容与步骤

#### 1. 使用传统JDBC方法与Model 1模型通过JSP页面访问数据库

【步骤1】在MySQL数据库test中创建books表，其结构如下：

```sql
CREATE TABLE books (
    bookid VARCHAR(10) NOT NULL PRIMARY KEY,
    title VARCHAR(50),
    author VARCHAR(20),
    publisher VARCHAR(40),
    price FLOAT 
);
```

向books表中插入几条记录：

```sql
insert into books (bookid, title, author, publisher, price)
values
    ('204', 'Head First Servlets & JSP', 'Bryan Basham', '中国电力出版社', 98),
    ('201', 'Servlets 与 JSP 核心课程', 'hall Marty', '清华大学出版社', 45),
    ('202', 'Tomcat 与 Java Web 开发技术详解', '孙卫琴', '机械工业出版社', 45),
    ('203', 'JSP 应用开发技术', '柳永坡', '人民邮电出版社', 52),
    ('205', 'J2EE 1.4 编程指南', 'Spielman Sue', '电子工业出版社', 68);
```

【步骤2】创建模型：编写了BookBean.java用于封装图书的信息；编写了BookDAO.java，采用传统JDBC方法创建数据库连接，对图书信息进行查询。

【步骤3】创建兼具视图与控制器功能的JSP页面：编写了displayBooks.jsp页面，使用JSP脚本调用BookDAO查询所有图书的信息，以表格的形式显示所有图书的书号、书名、作者、价格和出版社名称。

#### 2. 基于实验内容1创建的数据库表和模型，采用MVC设计模式，通过数据源和DAO对象访问数据库

本部分实现了MVC设计模式：
- 模型包括2个JavaBean：BookBean用于存放图书信息，BookDAO用于访问数据库。
- 控制器包括2个Servlet：BookQueryServlet根据请求参数查询图书信息、BookInsertServlet用来向数据库中插入一条图书信息。
- 视图包括4个JSP页面：bookQuery.jsp显示图书查询表单的页面、bookInsert.jsp显示收集图书信息表单的页面、display.jsp显示查询结果页面、errorPage.jsp显示查询错误页面。

#### 3. DAO设计模式练习

【步骤1】：使用root用户登录MySQL的test数据库，创建customer表，包括custName、email、phone等字段，设计了CustomerBean传输对象，使其实现java.io.Serializable接口。

```
CREATE TABLE customer (
    custName VARCHAR(50) NOT NULL,
    email VARCHAR(100) PRIMARY KEY,
    phone VARCHAR(20) NOT NULL
);
```

【步骤2】：创建了DAO接口、CustomerDAO接口及其实现类CustomerDAOImpl，实现了对Customer对象的数据库访问逻辑，包括获取数据源和连接对象，对Customer表进行查询、插入、修改和删除操作等，最后关闭指定的对象。

【步骤3】：创建了insertCustomer.jsp页面，通过一个表单录入向数据库中插入的数据。

【步骤4】：创建了InsertCustomerServlet.java控制器，调用CustomerDAO对象和传输对象，将数据插入到数据库中。

【步骤5】：创建了showCustomer.jsp，显示所有客户的信息，每一条客户信息后面增加修改和删除超链接，编写了ActionServlet.java控制器，调用DAO和传输对象实现对客户信息的删除和修改功能。

### 三、思考题

1. 总结并归纳传统JDBC方法访问数据库的步骤。

   传统JDBC方法访问数据库的步骤：
   ① 加载数据库驱动程序：使用Class.forName()方法加载相应的JDBC驱动。
   ② 建立连接对象：使用DriverManager.getConnection()方法建立与数据库的连接。
   ③ 创建语句对象：通过Connection对象创建Statement或PreparedStatement对象。
   ④ 执行SQL语句：使用Statement对象执行SQL查询或更新操作。
   ⑤ 处理结果集：对于查询操作，处理返回的ResultSet对象。
   ⑥ 关闭连接：按ResultSet、Statement、Connection的顺序关闭资源。

2. 总结并归纳使用数据源访问数据库的步骤。

   使用数据源访问数据库的步骤：
   ① 配置数据源：在应用服务器中配置数据源，设置数据库连接信息。
   ② 通过JNDI查找数据源：使用InitialContext.lookup()方法查找命名的数据源对象。
   ③ 通过数据源创建连接对象：调用数据源的getConnection()方法获取数据库连接。
   ④ 创建语句对象：通过Connection对象创建Statement或PreparedStatement对象。
   ⑤ 执行SQL语句：使用Statement对象执行SQL查询或更新操作。
   ⑥ 处理结果集：对于查询操作，处理返回的ResultSet对象。
   ⑦ 关闭连接：按ResultSet、Statement、Connection的顺序关闭资源，连接会被返回到连接池中。