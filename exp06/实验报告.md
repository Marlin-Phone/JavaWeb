# 实验六  Web事件处理与过滤器

班级                       学号                        姓名                   
## 实验报告

### 一、实验目的

1. 了解并掌握Servlet过滤器的作用、开发与部署的方法；
2. 了解并掌握过滤链的工作原理及编写方法；
3. 了解并掌握Servlet监听器的工作原理、开发与部署的方法；
4. 掌握ServletContext、HttpSession、ServletRequest对象上的事件及监听器处理方法。

### 二、实验要求

1. 实验前进行预习，完成实验预习报告；
2. 按照每一项实验内容进行上机实践与编程，将程序源代码和运行结果图附在实验报告中实验内容对应的部分。
3. 实验预习报告和实验报告打印装订在一起。
4. 将每一次实验的源代码按目录组织保存并压缩，按照老师指定的要求进行提交。代码保存方式如：exp06表示实验六Web项目的名称，其下保存各项实验内容的源文件及相关资源，将整个exp06文件夹进行压缩后命名为班级-姓名-实验06，如：计171-张三-实验06。

### 三、实验内容与要求

#### 1. 创建一个名为exp06的Web项目，编写、部署、测试一个ServletContext事件监听器

【步骤1】编写了MyServletContextListener.java监听器类，Web应用程序启动时创建一个数据库连接对象，并将其保存在ServletContext作用域中，Web应用销毁时将其清除；在ServletContext对象上添加属性、删除属性和替换属性时，在Tomcat日志中记录有关信息。

【步骤2】在web.xml文件中注册了监听器类，同时使用@WebListener注解进行双重注册。

【步骤3】编写了contextListenerTest.jsp测试页面：使用监听器创建的数据库连接对象连接MySQL数据库test，以表格的形式显示其中books数据表的所有内容。

【步骤4】在Tomcat下发布该Web应用，启动Tomcat，访问测试页面，成功显示了books表中的数据。

【步骤5】检查日志文件
通过查看Tomcat日志文件，确认了监听器的contextInitialized和contextDestroyed方法被正确调用，并记录了相应的日志信息。

#### 2. 编写一个HttpSession事件监听器用来记录当前在线人数

【步骤1】编写了MySessionListener监听器处理类，监视Web应用会话创建事件：每创建一个新的会话对象，就将其保存到会话对象的列表数组中，并将用户会话对象列表保存在ServletContext作用域中的sessionList属性中，同时向日志中写入"创建一个新会话"以及该会话的ID。当一个会话对象被删除时，从用户会话对象列表中删除该会话对象并保存，同时向日志中写入"删除一个会话"以及该会话的ID。

【步骤2】在web.xml文件中注册了该事件监听器，同时使用@WebListener注解进行双重注册。

【步骤3】编写了sessionDisplay.jsp测试页面，显示当前应用所有在线的会话对象的id及创建时间。通过多打开几个浏览器窗口，模拟多用户访问，验证了多用户会话统计功能的正确性。

#### 3. 编写一个ServletRequestListener监听器，记录某个页面自应用程序启动以来被访问的次数

【步骤1】编写了MyRequestListener监听器，在对onlineCount.jsp页面发送请求时进行访问次数计数器累加，并将计数器变量保存到应用作用域的属性中。

【步骤2】在web.xml文件中注册了该监听器，同时使用@WebListener注解进行双重注册。

【步骤3】编写了onlineCount.jsp页面，显示自应用程序启动以来该页面被访问的次数。

【步骤4】启动多个浏览器窗口访问该jsp页面，验证了页面访问次数统计功能的正确性，每次访问都会使计数器递增。

### 三、思考题

（此处可添加对实验的思考和总结）

### 四、实验总结

通过本次实验，我掌握了Servlet监听器的开发和部署方法，理解了ServletContext、HttpSession和ServletRequest对象上的事件处理机制。通过实现三个监听器，我深入理解了Web应用的生命周期管理，包括应用启动/销毁、会话创建/销毁和请求处理等事件的监听和处理。这些技术在实际开发中非常有用，可以用于资源管理、在线用户统计、访问统计等场景。