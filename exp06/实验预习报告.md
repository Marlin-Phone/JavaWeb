# 实验六  Web事件处理与过滤器

班级                       学号                        姓名                   
## 实验预习报告

### 一、实验目的

1. 了解并掌握Servlet过滤器的作用、开发与部署的方法；
2. 了解并掌握过滤链的工作原理及编写方法；
3. 了解并掌握Servlet监听器的工作原理、开发与部署的方法；
4. 掌握ServletContext、HttpSession、ServletRequest对象上的事件及监听器处理方法。

### 二、实验原理

1. Servlet过滤器基本原理
过滤器是web服务器上的组件，它们对客户和资源之间的请求和响应进行过滤。
过滤器的工作原理是：当servlet容器接收到对某个资源的请求，它要检查是否有过滤器与之关联。如果有过滤器与该资源关联，servlet容器将把该请求发送给过滤器。在过滤器处理完请求后，它将做下面3件事：
- 产生响应并将其返回给客户；
- 如果有过滤器链，它将把（修改过或没有修改过）请求传递给下一个过滤器；
- 将请求传递给不同的资源。
当请求返回到客户时，它是以相反的方向经过同一组过滤器返回。过滤器链中的每个过滤器可能修改响应。
过滤器API主要包括：Filter、FilterConfig和FilterChain接口。

2. Servlet监听器基本原理
在Web应用程序中，事件的处理也是通过事件监听器接口处理的。Web应用事件处理的原理为：当Web应用中某些状态改变时，Servlet容器就产生某种事件，如ServletContext对象初始化时会产生ServletContextEvent事件，此时Servlet容器就会从注册的事件监听器中寻找处理该事件的监听器对象，并执行相应的代码。

### 三、实验预习内容

1. 在Servlet 2.4规范中共定义了三种对象上的6种事件类型和8个事件监听器接口，他们分别是什么？请用表格形式上表示出来。

| 事件源 | 事件类型 | 事件类 | 监听器接口 |
|--------|--------|--------|-----------|
| ServletContext | 初始化 | ServletContextEvent | ServletContextListener |
| ServletContext | 属性变化 | ServletContextAttributeEvent | ServletContextAttributeListener |
| HttpSession | 创建/销毁 | HttpSessionEvent | HttpSessionListener |
| HttpSession | 属性变化 | HttpSessionBindingEvent | HttpSessionAttributeListener |
| HttpSession | 对象绑定/解绑 | HttpSessionBindingEvent | HttpSessionBindingListener |
| HttpServletRequest | 创建/销毁 | ServletRequestEvent | ServletRequestListener |
| HttpServletRequest | 属性变化 | ServletRequestAttributeEvent | ServletRequestAttributeListener |
| HttpSessionActivation | 激活/钝化 | HttpSessionEvent | HttpSessionActivationListener |

2. 如何配置Servlet监听器程序？

Servlet监听器程序可以通过两种方式配置：
- 使用注解：在监听器类上使用@WebListener注解，Servlet容器会自动注册该监听器。
- 使用web.xml文件：在web.xml文件中使用<listener>元素注册监听器，指定监听器类的全限定名。

3. 简述过滤器的工作原理。

过滤器的工作原理是：当Servlet容器接收到对某个资源的请求时，它会检查是否有过滤器与该资源关联。如果有，Servlet容器会将请求发送给过滤器。过滤器可以对请求进行预处理，然后决定是将请求传递给下一个过滤器（如果存在过滤器链）、传递给目标资源，还是直接生成响应返回给客户端。当响应返回时，它会以相反的方向经过同一组过滤器，每个过滤器都可能对响应进行修改。

4. 如何配置和访问带参数的过滤器？

带参数的过滤器可以通过以下方式配置和访问：
- 在web.xml文件中，使用<filter>元素定义过滤器，并使用<init-param>元素配置初始化参数。
- 在过滤器类中，通过FilterConfig对象的getInitParameter()方法获取初始化参数。
- 例如：
```xml
<filter>
    <filter-name>MyFilter</filter-name>
    <filter-class>com.filter.MyFilter</filter-class>
    <init-param>
        <param-name>encoding</param-name>
        <param-value>UTF-8</param-value>
    </init-param>
</filter>
```
在过滤器中通过filterConfig.getInitParameter("encoding")获取参数值。